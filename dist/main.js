!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(2));t.NUM_BLOCK_TYPES=7,t.BLK_OFFSETS_GAME=[21,5],t.BLK_OFFSETS_NEXT=[2,2],t.GRID_COLOR=o.Grey,t.BLK_EDGE_COLOR=o.White,t.DEFAULT_GAME_AREA=[20,10],t.getRandomInt=function(e){return Math.floor(Math.random()*Math.floor(e))}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),a=n(r(2)),i=r(4),s=r(5),c=r(10),l=r(11),u=n(r(0)),h=function(){function e(t,r,n,a){void 0===n&&(n=u.DEFAULT_GAME_AREA[1]),void 0===a&&(a=u.DEFAULT_GAME_AREA[0]);var h=this;this.status=l.GameStatus.Pause,this.init=function(){e.lines=0,document.getElementById("label").innerText=e.lines,i.GameAreaManager.getInstance().clear(),e.curBlock=new o.Block(u.getRandomInt(u.NUM_BLOCK_TYPES)),e.nextBlock=new o.Block(u.getRandomInt(u.NUM_BLOCK_TYPES)),h.checkGameOver(),h.drawAll(),h.on()},this.drawBlock=function(e){h.drawSquareOnPosition(e.getCurRotation(),e.color)},this.render=function(){h.renderLoop=function(){window.setTimeout(function(){window.requestAnimationFrame(h.renderLoop),h.status!=l.GameStatus.On||h.refresh("DOWN")||h.changeCurBlock()},e.dropInterval)},h.renderLoop()},this.stopRender=function(){h.status=l.GameStatus.Over,document.getElementById("sBtn").innerText="RETRY",document.getElementById("sBtn").style.background="#18bff2"},this.refresh=function(t){void 0===t&&(t=!1);var r=!1;return h.graphService.clearBuffer(),"boolean"==typeof t?t&&e.curBlock.rotate():r=e.curBlock.move(t),h.drawAll(),r},this.drawAll=function(){h.drawGrid(),h.drawStaticArea(i.GameAreaManager.getInstance().getGameArea()),h.drawBlock(e.curBlock),h.nextManager.drawAll()},this.drawStaticArea=function(e){for(var t=0;t<e.length;t++)for(var r=0;r<e[t].length;r++)void 0!==e[t][r]&&h.drawSquareOnPosition([t,r],e[t][r])},this.on=function(){document.getElementById("sBtn").innerText="PAUSE",document.getElementById("sBtn").style.background="#fff435",h.status=l.GameStatus.On},this.pause=function(){document.getElementById("sBtn").innerText="START",document.getElementById("sBtn").style.background="#29d323",h.status=l.GameStatus.Pause},this.createKeyboardListener=function(){window.addEventListener("keydown",function(t){if("r"===t.key)h.init();else if("q"===t.key)confirm("Quit game? \nThis will close current tab!")&&close();else if(h.status===l.GameStatus.On)if("ArrowDown"===t.key)h.refresh("DOWN");else if("ArrowLeft"===t.key)h.refresh("LEFT");else if("ArrowRight"===t.key)h.refresh("RIGHT");else if("ArrowUp"===t.key)h.refresh(!0);else if(" "===t.key){for(;e.curBlock.move("DOWN"););h.changeCurBlock()}else"p"===t.key&&h.pause();else h.status===l.GameStatus.Pause&&"c"===t.key&&h.on()},!1)},this.getStatus=function(){return h.status},this.boxesPerRow=n,this.boxesPerColumn=a,this.graphService=new s.GraphService(t),this.canvas=t,i.GameAreaManager.getInstance(this.boxesPerColumn,this.boxesPerRow),this.nextManager=new c.NextBlockManager(r)}return e.prototype.drawSquareOnPosition=function(e,t){for(var r=this.canvas.width/this.boxesPerRow,n=this.canvas.height/this.boxesPerColumn,o=0;o<e.length;o+=2){var i=e[o],s=e[o+1],c=[];c=c.concat([s*r,i*n]).concat([(s+1)*r,i*n]).concat([s*r,(i+1)*n]).concat([(s+1)*r,(i+1)*n]),this.graphService.drawSquare(c,t),c=c.concat(c[0],c[1],c[4],c[5],c[2],c[3],c[6],c[7]),this.graphService.drawLine(c,a.White)}},e.prototype.drawGrid=function(){for(var e=this.canvas.width/this.boxesPerRow,t=this.canvas.height/this.boxesPerColumn,r=[],n=0;n<=this.boxesPerColumn;n++)r=r.concat([0,n*t]).concat([this.canvas.width,n*t]);for(n=0;n<=this.boxesPerRow;n++)r=r.concat([n*e,0]).concat([n*e,this.canvas.height]);this.graphService.drawLine(r,u.GRID_COLOR)},e.prototype.changeCurBlock=function(){e.curBlock.addToGameArea(),i.GameAreaManager.getInstance().eliminateRows(),e.curBlock=e.nextBlock,e.nextBlock=new o.Block(u.getRandomInt(u.NUM_BLOCK_TYPES)),this.checkGameOver(),this.refresh()},e.prototype.checkGameOver=function(){for(;Math.max.apply(Math,e.curBlock.getCurRotation())>19;)if(!e.curBlock.move("DOWN")){this.stopRender(),console.log("Game Over");break}},e.curBlock=new o.Block(u.getRandomInt(u.NUM_BLOCK_TYPES)),e.nextBlock=new o.Block(u.getRandomInt(u.NUM_BLOCK_TYPES)),e.dropInterval=1e3,e}();t.GameManager=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Yellow={RGB:[.945,.792,.196]},t.Red={RGB:[.984,.054,.278]},t.Blue={RGB:[.101,.109,.976]},t.Green={RGB:[.298,.843,.098]},t.Purple={RGB:[.623,.098,.843]},t.SkyBlue={RGB:[.243,.933,.976]},t.Orange={RGB:[1,.55,0]},t.Grey={RGB:[.7,.7,.7]},t.White={RGB:[1,1,1]}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=r(7),a=r(4),i=n(r(0)),s=function(){return function(e,t,r){void 0===t&&(t=i.BLK_OFFSETS_GAME[0]),void 0===r&&(r=i.BLK_OFFSETS_GAME[1]);var n=this;this.getCurRotation=function(){return n.rotations[n.roationIndex]},this.getNextRotation=function(){return n.rotations[(n.roationIndex+1)%n.rotations.length]},this.rotate=function(){var e=(n.roationIndex+1)%n.rotations.length;if(n.rotationEligible(n.rotations,e))n.roationIndex=e;else{var t=n.move("RIGHT");if(t&&n.rotationEligible(n.rotations,e))return void(n.roationIndex=e);t&&n.move("LEFT");var r=n.move("LEFT");if(r&&n.rotationEligible(n.rotations,e))return void(n.roationIndex=e);r&&n.move("RIGHT")}},this.move=function(e){var t,r;switch(e){case"DOWN":r=n.rotations.map(function(e){return e.map(function(e,t){return t%2==0?e-1:e})});break;case"LEFT":r=n.rotations.map(function(e){return e.map(function(e,t){return t%2==0?e:e-1})});break;case"RIGHT":r=n.rotations.map(function(e){return e.map(function(e,t){return t%2==0?e:e+1})});break;default:console.log("unknown DirType!")}return(t=n.rotationEligible(r,n.roationIndex))&&(n.rotations=r),t},this.rotationEligible=function(e,t){for(var r=a.GameAreaManager.getInstance().getGameArea(),n=0;n<e[t].length;n+=2){var o=e[t][n],s=e[t][n+1];if(s<0||s>i.DEFAULT_GAME_AREA[1]-1||o<0||o>i.DEFAULT_GAME_AREA[0]+1||null!=r[o][s])return!1}return!0},this.addToGameArea=function(){for(var e=a.GameAreaManager.getInstance().getGameArea(),t=0;t<n.rotations[n.roationIndex].length;t+=2){var r=n.rotations[n.roationIndex][t],o=n.rotations[n.roationIndex][t+1];void 0===e[r][o]?e[r][o]=n.color:console.log("Attaching square on ["+o+", "+r+"] failed")}},this.type=e;var s=o.loadRotations(this.type);this.color=s.c,this.rotations=s.r,2!=r&&(r=i.getRandomInt(7)+2),this.rotations=this.rotations.map(function(e){return e.map(function(e,n){return n%2==0?e+t:e+r})}),this.roationIndex=i.getRandomInt(this.rotations.length)}}();t.Block=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(1),a=function(){function e(){var t=this;this.gameArea=[],this.getGameArea=function(){return t.gameArea},this.eliminateRows=function(){for(var e=0;e<t.gameArea.length;e++)t.gameArea[e].includes(void 0)||(o.GameManager.lines++,t.gameArea.splice(e,1),t.gameArea.splice(t.gameArea.length,0,new Array(10)),e--);document.getElementById("label").innerText=o.GameManager.lines},this.clear=function(){t.gameArea=new Array(e.boxPerColumn+2);for(var r=0;r<t.gameArea.length;r++)t.gameArea[r]=new Array(e.boxPerRow)},this.clear()}return e.getInstance=function(t,r){return void 0===t&&(t=n.DEFAULT_GAME_AREA[0]),void 0===r&&(r=n.DEFAULT_GAME_AREA[1]),void 0===e.instance&&(e.boxPerColumn=t,e.boxPerRow=r,e.instance=new e),e.instance},e}();t.GameAreaManager=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8),o=r(9),a=function(){function e(e){var t=this;this.clearBuffer=function(){t.gl.clear(t.gl.COLOR_BUFFER_BIT)},this.graphCanvas=e,this.gl=e.getContext("webgl"),this.gl||alert("Your browser doesn't support WebGL!"),this.init()}return e.prototype.init=function(){this.initGlCanvas(),this.setupShaderAndProgram(),this.setResolution()},e.prototype.initGlCanvas=function(){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.viewport(0,0,this.graphCanvas.width,this.graphCanvas.height)},e.prototype.setupShaderAndProgram=function(){var e=this.gl.createShader(this.gl.VERTEX_SHADER),t=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,n.vertexShaderText),this.gl.shaderSource(t,o.fragmentShaderText),this.gl.compileShader(e),this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)?(this.gl.compileShader(t),this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS)?(this.program=this.gl.createProgram(),this.gl.attachShader(this.program,e),this.gl.attachShader(this.program,t),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)?(this.gl.validateProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.VALIDATE_STATUS)?this.gl.useProgram(this.program):console.error("ERROR validating program!",this.gl.getProgramInfoLog(this.program))):console.error("ERROR linking program!",this.gl.getProgramInfoLog(this.program))):console.error("ERROR compiling fragment shader!",this.gl.getShaderInfoLog(t))):console.error("ERROR compiling vertex shader!",this.gl.getShaderInfoLog(e))},e.prototype.setResolution=function(){var e=this.gl.getUniformLocation(this.program,"u_resolution");this.gl.uniform2f(e,this.gl.canvas.width,this.gl.canvas.height)},e.prototype.setAttributes=function(){var e=this.gl.getAttribLocation(this.program,"vertPosition"),t=this.gl.getAttribLocation(this.program,"vertColor");this.gl.vertexAttribPointer(e,2,this.gl.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,0),this.gl.vertexAttribPointer(t,3,this.gl.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,2*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(e),this.gl.enableVertexAttribArray(t)},e.prototype.merge=function(e,t){for(var r=[],n=0;n<e.length;n+=2)r=r.concat(e.slice(n,n+2)).concat(t);return new Float32Array([].concat.apply([],r))},e.prototype.drawSquare=function(e,t){var r=e.length/2,n=this.merge(e,t.RGB),o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.STATIC_DRAW),this.setAttributes(),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,r)},e.prototype.drawLine=function(e,t){var r=e.length/2,n=this.merge(e,t.RGB),o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.STATIC_DRAW),this.setAttributes(),this.gl.drawArrays(this.gl.LINES,0,r)},e}();t.GraphService=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);console.log("This is working!");var o=document.getElementById("gl-canvas"),a=document.getElementById("next-canvas"),i=new n.GameManager(o,a);i.init(),i.createKeyboardListener(),i.render();var s=document.getElementById("sBtn");s.addEventListener("click",function(){"START"===s.textContent?i.on():"PAUSE"===s.textContent?i.pause():"RETRY"===s.textContent&&i.init()})},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(r(2));!function(e){e[e.O=0]="O",e[e.I=1]="I",e[e.S=2]="S",e[e.Z=3]="Z",e[e.L=4]="L",e[e.J=5]="J",e[e.T=6]="T"}(o=t.BlockType||(t.BlockType={})),t.loadRotations=function(e){var t,r=new Array;switch(e){case o.O:t=a.Yellow,r.push([-1,-1,0,-1,0,0,-1,0]);break;case o.I:t=a.Red,r.push([0,-2,0,-1,0,0,0,1]),r.push([-2,0,-1,0,0,0,1,0]);break;case o.S:t=a.Blue,r.push([-1,-1,-1,0,0,0,0,1]),r.push([1,0,0,0,0,1,-1,1]);break;case o.Z:t=a.Green,r.push([0,-1,0,0,-1,0,-1,1]),r.push([-1,0,0,0,0,1,1,1]);break;case o.L:t=a.Purple,r.push([-1,-1,0,-1,0,0,0,1]),r.push([1,0,0,0,-1,0,-1,1]),r.push([0,-1,0,0,0,1,1,1]),r.push([1,-1,1,0,0,0,-1,0]);break;case o.J:t=a.SkyBlue,r.push([0,-1,0,0,0,1,-1,1]),r.push([1,1,1,0,0,0,-1,0]),r.push([1,-1,0,-1,0,0,0,1]),r.push([-1,-1,-1,0,0,0,1,0]);break;case o.T:t=a.Orange,r.push([0,-1,0,0,0,1,-1,0]),r.push([1,0,0,0,-1,0,0,1]),r.push([0,-1,0,0,0,1,1,0]),r.push([1,0,0,0,-1,0,0,-1]);break;default:console.log("Unknown BlockType")}return{c:t,r:r}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vertexShaderText=["precision mediump float;","attribute vec2 vertPosition;","uniform vec2 u_resolution;","","attribute vec3 vertColor;","varying vec3 fragColor;","","void main() {","","   fragColor = vertColor;","","   // convert the position from pixels to 0.0 to 1.0","   vec2 zeroToOne = vertPosition / u_resolution;","   // convert from 0->1 to 0->2","   vec2 zeroToTwo = zeroToOne * 2.0;","   // convert from 0->2 to -1->+1 (clipspace)","   vec2 clipSpace = zeroToTwo - 1.0;","   gl_Position = vec4(clipSpace, 0, 1);","}"].join("\n")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fragmentShaderText=["// fragment shaders dont have a default precision so we need","// to pick one. mediump is a good default","precision mediump float;","","varying vec3 fragColor;","","void main() {","    // gl_FragColor is a special variable a fragment shader","    // is responsible for setting","    gl_FragColor = vec4(fragColor, 1.0);","}"].join("\n")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),o=r(3),a=r(1),i=r(0),s=function(){function e(e,t,r){void 0===t&&(t=4),void 0===r&&(r=4);var s=this;this.drawNext=function(){var e=new o.Block(a.GameManager.nextBlock.type,i.BLK_OFFSETS_NEXT[0],i.BLK_OFFSETS_NEXT[1]);s.drawSquareOnPosition(e.rotations[a.GameManager.nextBlock.roationIndex],e.color)},this.drawAll=function(){s.graphService.clearBuffer(),s.drawGrid(),s.drawNext()},this.boxesPerRow=t,this.boxesPerColumn=r,this.graphService=new n.GraphService(e),this.canvas=e}return e.prototype.drawSquareOnPosition=function(e,t){for(var r=this.canvas.width/this.boxesPerRow,n=this.canvas.height/this.boxesPerColumn,o=0;o<e.length;o+=2){var a=e[o],s=e[o+1],c=[];c=c.concat([s*r,a*n]).concat([(s+1)*r,a*n]).concat([s*r,(a+1)*n]).concat([(s+1)*r,(a+1)*n]),this.graphService.drawSquare(c,t),c=c.concat(c[0],c[1],c[4],c[5],c[2],c[3],c[6],c[7]),this.graphService.drawLine(c,i.BLK_EDGE_COLOR)}},e.prototype.drawGrid=function(){for(var e=this.canvas.width/this.boxesPerRow,t=this.canvas.height/this.boxesPerColumn,r=[],n=0;n<=this.boxesPerColumn;n++)r=r.concat([0,n*t]).concat([this.canvas.width,n*t]);for(n=0;n<=this.boxesPerRow;n++)r=r.concat([n*e,0]).concat([n*e,this.canvas.height]);this.graphService.drawLine(r,i.GRID_COLOR)},e}();t.NextBlockManager=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.On=0]="On",e[e.Pause=1]="Pause",e[e.Over=2]="Over"}(t.GameStatus||(t.GameStatus={}))}]);
//# sourceMappingURL=main.js.map